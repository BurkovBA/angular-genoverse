!function(){function e(){return{restrict:"E",scope:!1,template:"<div class='wrap genoverse-wrap' style='overflow-x:auto;'>    <p class='text-muted'>        <span id='genomic-location' class='margin-right-5px'></span>        View in <a href='' id='ensembl-link' target='_blank'>Ensembl</a>        <span class='ucsc-link'>|            <a href='' target='_blank'>UCSC</a>        </span>    </p><div id='genoverse'></div></div>",link:function(e,s,n){function a(){s.find(".genoverse-wrap h2").show()}function r(){var n="<em>"+e.genome.species+" "+e.chromosome+":"+d(e.start)+"-"+d(e.end)+":"+e.strand+"</em>";s.find("#genoverse-coordinates").html("").hide().html(n).fadeIn("slow"),n="<p>"+e.description+"</p>",s.find("#genoverse-description").html("").hide().html(n).fadeIn("slow")}function i(){var n={container:s.find("#genoverse"),chr:e.chromosome,species:e.genome.species,showUrlCoords:!1,plugins:["controlPanel","resizer","fileDrop"],tracks:[Genoverse.Track.Scalebar,Genoverse.Track.extend({name:"Sequence",model:o("ensemblSequence"),view:Genoverse.Track.View.Sequence,resizable:"auto",1e5:!1}),Genoverse.Track.extend({name:"Genes",info:"Ensembl API genes",labels:!0,model:o("ensemblGene"),view:Genoverse.Track.View.Gene.Ensembl}),Genoverse.Track.extend({name:"Transcripts",info:"Ensembl API transcripts",labels:!0,model:o("ensemblTranscript"),view:Genoverse.Track.View.Transcript.Ensembl}),Genoverse.Track.extend({name:"RNAcentral",id:"RNAcentral",info:"Unique RNAcentral Sequences",labels:!0,model:o("rnacentral"),view:Genoverse.Track.View.Transcript.Ensembl})]};return n=_(n)}function o(s){var n,a,r=t(g(e.genome.species));return"ensemblGene"===s?(a="//__ENDPOINT__/overlap/region/__SPECIES__/__CHR__:__START__-__END__?feature=gene;content-type=application/json".replace("__ENDPOINT__",r).replace("__SPECIES__",g(e.genome.species)),n=Genoverse.Track.Model.Gene.Ensembl.extend({url:a})):"ensemblTranscript"===s?(a="//__ENDPOINT__/overlap/region/__SPECIES__/__CHR__:__START__-__END__?feature=transcript;feature=exon;feature=cds;content-type=application/json".replace("__ENDPOINT__",r).replace("__SPECIES__",g(e.genome.species)),n=Genoverse.Track.Model.Transcript.Ensembl.extend({url:a})):"ensemblSequence"===s?(a="//__ENDPOINT__/sequence/region/__SPECIES__/__CHR__:__START__-__END__?content-type=text/plain".replace("__ENDPOINT__",r).replace("__SPECIES__",g(e.genome.species)),n=Genoverse.Track.Model.Sequence.Ensembl.extend({url:a})):"rnacentral"===s&&(window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.host+"/"),a=window.location.origin+"/api/v1/overlap/region/__SPECIES__/__CHR__:__START__-__END__".replace("__SPECIES__",g(e.genome.species)),n=Genoverse.Track.Model.Gene.Ensembl.extend({url:a,parseData:function(e){for(var s=0;s<e.length;s++){var n=e[s];"transcript"!==n.feature_type||this.featuresById[n.ID]?"exon"===n.feature_type&&this.featuresById[n.Parent]&&(n.id=n.ID,this.featuresById[n.Parent].exons[n.id]||(this.featuresById[n.Parent].exons.push(n),this.featuresById[n.Parent].exons[n.id]=n)):(n.id=n.ID,n.label=n.external_name,n.exons=[],n.cds=[],this.insertFeature(n))}}})),n}function t(e){var s=["ailuropoda_melanoleuca","anas_platyrhynchos","anolis_carolinensis","astyanax_mexicanus","bos_taurus","callithrix_jacchus","canis_lupus_familiaris","cavia_porcellus","ceratotherium_simum_simum","chlorocebus_sabaeus","choloepus_hoffmanni","chrysemys_picta_bellii","ciona_intestinalis","ciona_savignyi","cricetulus_griseus","danio_rerio","dasypus_novemcinctus","dipodomys_ordii","drosophila_melanogaster","echinops_telfairi","equus_caballus","erinaceus_europaeus","felis_catus","ficedula_albicollis","gadus_morhua","gallus_gallus","gasterosteus_aculeatus","gorilla_gorilla_gorilla","heterocephalus_glaber","homo_sapiens","ictidomys_tridecemlineatus","latimeria_chalumnae","lepisosteus_oculatus","loxodonta_africana","macaca_fascicularis","macaca_mulatta","macropus_eugenii","meleagris_gallopavo","melopsittacus_undulatus","microcebus_murinus","microtus_ochrogaster","monodelphis_domestica","mus_musculus","mustela_putorius_furo","myotis_lucifugus","nomascus_leucogenys","ochotona_princeps","oreochromis_niloticus","ornithorhynchus_anatinus","orycteropus_afer_afer","oryctolagus_cuniculus","oryzias_latipes","otolemur_garnettii","ovis_aries","pan_troglodytes","papio_anubis","papio_hamadryas","pelodiscus_sinensis","petromyzon_marinus","poecilia_formosa","pongo_abelii","procavia_capensis","pteropus_vampyrus","rattus_norvegicus","saimiri_boliviensis","sarcophilus_harrisii","sorex_araneus","sus_scrofa","sus_scrofa_map","taeniopygia_guttata","takifugu_rubripes","tarsius_syrichta","tetraodon_nigroviridis","tupaia_belangeri","tursiops_truncatus","vicugna_pacos","xenopus_tropicalis","xiphophorus_maculatus"];return s.indexOf(e)>-1?"rest.ensembl.org":"rest.ensemblgenomes.org"}function _(s){return is_karyotype_available(e.genome.species)?(s.plugins.push("karyotype"),s.genome="grch38"):s.chromosomeSize=Math.pow(10,20),s}function c(){l(g(e.genome.species))||$(".gv_wrapper").prepend("<div class='genoverse_karyotype_placeholder'>  <p>Karyotype display is not available</p></div>")}function l(e){return u(e)&&p()}function u(e){console.log("species = ",e);var s=["homo_sapiens"];return s.indexOf(e)!==-1}function p(){var s=[];for(var n in grch38)s.push(n);return s.indexOf(e.chromosome.toString())}function m(){e.browser.on({afterSetRange:function(){setTimeout(function(){s.find(".genoverse-wrap .resizer").click()},1e3)}})}function d(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function g(e){return"Canis familiaris"==e&&(e="Canis lupus familiaris"),e.replace(/ /g,"_").toLowerCase()}a(),r(),e.browser=new Genoverse(i()),c(),m()}}}angular.module("Genoverse",[]).directive("genoverse",e)}();
